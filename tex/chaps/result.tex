\chapter{結果と考察}
\label{CResult}

%% \textcolor{red}{****メモ始め****}
%% \begin{itemize}
%% \item 使用したテクスチャとかの画像を載せる
%% \item 形状モデルのワイヤフレーム画像
%% \item ポリゴン数とか面の数、頂点の数でテーブルを作成する
%% \item 球がひとつの場合の実物との比較
%% \item 平面オブジェクトに対する実行結果と解像度$R_t$の評価
%% \item 球体オブジェクト
%% \item 実行結果の処理速度のグラフを作る
%% \item 結果の実物との比較
%% \item 定性的評価
%% \item さまざまなオブジェクトへの適用
%% \item 鹿児島アートフェスタ
%% \end{itemize}
%% \textcolor{red}{****メモ終わり****}

\section{実装方法および実行環境}
\label{SEnvironment}

本手法ではグラフィックスライブラリとしてOpenGL(オープンジーエル: Open Graphics Library)を利用し、プログラムの実装にあたってはC++言語を用いている。
本手法を適用する形状データはAutodesk Maya \textcolor{red}{2013}で作成したオブジェクトファイルを使って作成した。

プログラムの実行に使用した計算機のハードウェア構成は\tabref{tab:experiment-hadrware}のとおりである。

\begin{table}
\centering
\caption{実行環境 \label{tab:experiment-hadrware}}
\begin{tabular}{r|l}
\hline
CPU & Intel Core i7 960 3.20 GHz \\ \hline
メモリ & 30 GB \\ \hline
GPU & NVIDIA GeForce GTX 660 \\ \hline
%グラフィックメモリ & 3 GB GDDR5 \\ \hline
\end{tabular}
\end{table}

%------------------------------------------------------------------------------------------
\section{処理系}
\label{S}

\subsection{内処理、外処理}
\label{SSInnerOuterProcess}

\chapref{CMethod}で述べた隣接球を通過する光の挙動について、平面オブジェクトおよび球体オブジェクトを例に問題点を指摘する。
%% 本手法で用いた複眼の近似モデル（\secref{SSModel}）では、個眼のレンズの代わりに球体レンズを利用している。
%% また、本来は予備実験\secref{SSMarbleOnHole}のように最密に球を配置することが理想であるが、本手法では評価実験のためにアルゴリズムが簡略な格子状の配置を採択している。**methodに追記する**
本手法では、球体レンズ同士の間にできる隙間を埋めるために、球の直径を球同士の中心距離よりも大きく設定している（\secref{SSMultiRefraction}）。
また、複数の球を通過する光を想定し、光が球の外部を経由して隣接する球に入射する場合のアルゴリズムを実装していた。
しかし、外部を経由する場合の実装（以下、外部通過処理）によって得られる結果画像にはノイズが多く、求める画像とは異なる結果となってしまった\figref{FNoise}。
\begin{figure}[htbp]
  \centering
\subfigure[平面オブジェクト]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Noise/pscreenshot005.bmp}
\label{FNoisePlane}}
\subfigure[球体オブジェクト]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Noise/screenshot000.bmp}
\label{FNoiseSphere}}
  \caption{外部通過処理に見られるノイズ}
  \label{FNoise}
\end{figure}
そのため、手法の修正として外部通過処理を実装から排除し、球の内部から内部への光の通過を考慮した実装（以下、内部通過処理）のみを採択することにした。

外部通過処理を排除しても、本手法で想定される範囲内では問題はないと考えられる。
理由として、外部通過処理と内部通過処理のそれぞれによって得られる画像にはノイズの有無以外に大きな差異が観測されなかったことと、球の半径を十分に大きい値で設定すれば、球の外部を経由して隣接する球に入射する光はあまり存在しないと推測されることが挙げられる。
ゆえに、本章での考察は主に内部通過処理によって得られるものに対して行う。

%------------------------------------------------------------------------------------------

\section{ジオメトリ}
\label{S}

\subsection{レンズ半径と偽瞳孔の数}
\label{SS}

本手法では、レンズの位置座標とレンズの半径は独立して扱うことができる。
\secref{SSInnerOuterProcess}でも述べたように、本手法では配置された球体レンズ同士の間の隙間を埋めるため、球の半径を球同士が接するよりも大きい値で設定しており、球の半径によって光の入射する領域のレンズの曲率が変化する。
すなわち、球の半径$r$の設定値によって複眼の外観が変化するため、両者の関係について考察を行う。
以下ではテクスチャに\figref{}を使用しており、テクスチャ解像度$R_t = 300$を使用している。

\begin{figure}[htbp]
  \centering
\subfigure[$r = 0.03$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_30/screenshot000.bmp}
\label{FRadius003-0}}
\subfigure[$r = 0.03$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_30/screenshot001.bmp}
\label{FRadius003-1}}
\subfigure[$r = 0.03$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_30/screenshot002.bmp}
\label{FRadius003-2}}\\
\subfigure[$r = 0.04$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_24/screenshot000.bmp}
\label{FRadius004-0}}
\subfigure[$r = 0.04$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_24/screenshot001.bmp}
\label{FRadius004-1}}
\subfigure[$r = 0.04$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_24/screenshot002.bmp}
\label{FRadius004-2}}\\
\subfigure[$r = 0.06$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_16/screenshot000.bmp}
\label{FRadius006-0}}
\subfigure[$r = 0.06$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_16/screenshot001.bmp}
\label{FRadius006-1}}
\subfigure[$r = 0.06$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_16/screenshot002.bmp}
\label{FRadius006-2}}\\
\subfigure[$r = 0.10$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_10/screenshot000.bmp}
\label{FRadius010-0}}
\subfigure[$r = 0.10$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_10/screenshot001.bmp}
\label{FRadius010-1}}
\subfigure[$r = 0.10$]{
\includegraphics*[width=.3\columnwidth]{./img/screenshot/sphere/Radius/1_10/screenshot002.bmp}
\label{FRadius010-2}}
  \caption{レンズ半径$r$と偽瞳孔の数の関係}
  \label{FRadiusAndNumber}
\end{figure}

比較画像\figref{FRadiusAndNumber}からレンズ半径が大きくなるにつれて観測される偽瞳孔の数は増加していることがわかる。
これは、半径が小さく曲率が大きければ個眼の端でのレンズ表面への進入角が小さくなるので、より内側への屈折が起こり、逆に半径が大きく曲率が小さければ、進入角が相対的に大きくなるので屈折の度合いが抑えられ、結果的に隣接する色素細胞テクスチャへ到達する頻度が高くなるためであると考えられる。

再現性を高めるためには、対象生物の個眼のレンズの曲率を測定するか、ユーザが任意の半径値$r$を設定することが必要となるが、ある程度恣意的に結果を操作できる点はユーザビリティにつながるのではないだろうか。
事実、生物種によって観察される偽瞳孔の密度や分布は異なるため、求める結果を得るための試行錯誤が必要である。

\subsection{視点との距離による偽瞳孔の分布}
\label{SSViewDist}



\subsection{歪みとテクスチャの関係}
\label{SSDistortion}

結果画像の一部には歪みが生じている部分が存在する\figref{}。
これは、オブジェクトに適用されたテクスチャに継ぎ目が存在し、なめらかに接続していないことが原因である。
本手法の特性上、曲面オブジェクトの表面に対しては格子状にテクスチャを適用する必要があるため、立体表面でテクスチャの歪みが生じることは避けられない。
すなわち、閉じた立体ではなく開いた曲面もしくはテクスチャの継ぎ目を表示しないモデルを使用するなどの工夫が要求される。
また、この問題はレンズ球の配置条件によって生じるので、レンズ球の配置アルゴリズムを改善するなどの対応策が今後求められる。

\begin{figure}[htbp]
  \centering
\subfigure[]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Distortion/screenshot000.bmp}
\label{FTexTortion0}}
\subfigure[]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Distortion/tex_tortion1.png}
\label{FTexTortion1}}\\
\subfigure[]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Distortion/tex_tortion2.png}
\label{FTexTortion2}}
\subfigure[]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/Distortion/tex_tortion3.png}
\label{FTexTortion3}}\\
  \caption{テクスチャの継ぎ目}
  \label{FTexTortion}
\end{figure}



%------------------------------------------------------------------------------------------

\section{パラメータと実行速度}
\label{SParameterAndExeTime}

それぞれのパラメータに応じて得られる結果画像や実行速度について比較、検討を行う。
評価を行うパラメータは光が通過する球の数の上限値、カメラとの距離、テクスチャの解像度である。
対象オブジェクトは以下に示す平面オブジェクトおよび球体オブジェクトとする。
\begin{figure}[htbp]
  \centering
\subfigure[平面オブジェクト（ワイヤフレーム）]{
\includegraphics*[width=.45\columnwidth]{./img/TEMP}
\label{FNoisePlane}}
\subfigure[球体オブジェクト（ワイヤフレーム）]{
\includegraphics*[width=.45\columnwidth]{./img/TEMP}
\label{FNoiseSphere}}
  \caption{評価オブジェクト（ワイヤフレーム表示）}
  \label{FEvalObject}
\end{figure}


\subsection{隣接球の処理ON/OFF}
\label{SSLimitNeighborSphere}

光がどの程度の回数、隣接球を通過する必要があるのかについての考察を行う。
光が複眼表面に対して平行に近い角度で入射した場合、光はひとつの球だけではなくふたつ以上の球を通過すると考えられる。
通過する球の数が増えればそれだけ処理に時間がかかるため、通過する球の数には上限値を設定する必要がある。
すなわち、物理的な正確さと処理速度はトレードオフの関係にあると言える。

では、通過する球の数の上限値を変化させることによって得られる結果について議論を行う。
上限値を設定することによる操作をここでは隣接球処理と呼ぶことにする。
以下では上限値$l = 0,1,2,3, ......$のように設定し、上限値$l$が$0$の場合には隣接球処理を行わないこととする。
すなわち、$l = 0$の場合、最初の球に入射した光は他のいかなる隣接球にも入射せずテクスチャ平面(\secref{SSModel})へ到達するものとして考える。
以下にまず、各$l$の値に対する結果を示す\figref{FLimitCompare1}\figref{FLimitCompare2}。
テクスチャは\figref{}を使用しており、球の半径$r$の値は約$3.3 \times 10^{-2}$、テクスチャ解像度$R_t = 300$を使用している。

\begin{figure}[htbp]
  \centering
\subfigure[$l = 0$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/000/screenshot002.bmp}
\label{FLimit0-4}}
\subfigure[$l = 1$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/001/screenshot002.bmp}
\label{FLimit1-4}}\\
\subfigure[$l = 2$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/002/screenshot002.bmp}
\label{FLimit2-4}}
\subfigure[$l = 3$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/003/screenshot002.bmp}
\label{FLimit3-4}}\\
\subfigure[$l = 5$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/005/screenshot002.bmp}
\label{FLimit5-4}}
\subfigure[$l = 10$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/010/screenshot002.bmp}
\label{FLimit10-4}}
  \caption{上限値による画像の変化1}
  \label{FLimitCompare1}
\end{figure}

\begin{figure}[htbp]
  \centering
\subfigure[$l = 0$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/000/screenshot001.bmp}
\label{FLimit0-3}}
\subfigure[$l = 1$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/001/screenshot001.bmp}
\label{FLimit1-3}}\\
\subfigure[$l = 2$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/002/screenshot001.bmp}
\label{FLimit2-3}}
\subfigure[$l = 3$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/003/screenshot001.bmp}
\label{FLimit3-3}}\\
\subfigure[$l = 5$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/005/screenshot001.bmp}
\label{FLimit5-3}}
\subfigure[$l = 10$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/010/screenshot001.bmp}
\label{FLimit10-3}}\\
  \caption{上限値による画像の変化2}
  \label{FLimitCompare2}
\end{figure}



\newpage
結果画像からは$l = 0$の場合とそれ以外とで顕著な差異が見られ、$l = 1$および$l = 2$の場合とそれ以外の場合でわずかな差異が確認できた。
また、$l = 3$以上の場合については肉眼で判別できるほどの差異は見つからなかった。
まず、$l = 0$の場合とそれ以外との差異について述べる。
$l = 0$の場合、side pupil(\secref{SSSidePupil})の存在が確認できるものの、他の場合と比較するとやや黒色が薄く、隣接球処理をした場合のほうがはっきりとしたside pupilとなっていることがわかる。
\begin{figure}[htbp]
  \centering
\subfigure[$l = 1$]{
\includegraphics*[width=.75\columnwidth]{./img/screenshot/sphere/RefracLimit/001/pupil4_explain.png}
\label{FPupil4}}\\
\subfigure[$l = 1$]{
\includegraphics*[width=.75\columnwidth]{./img/screenshot/sphere/RefracLimit/001/pupil3_explain.png}
\label{FPupil3}}
  \caption{各偽瞳孔の名称および場所}
  \label{FPseudopupilName}
\end{figure}
$l = 1,2$の場合とそれ以外の場合を代表して$l = 3$の場合について比較を行うと、球体オブジェクトの縁において有意差が見られる。
$l = 1$の場合、side pupilのさらに外側に位置するsecond side pupil(\figref{FLimitCompare3}\figref{FLimitCompare4}緑部)のあたりは$l = 3$の場合よりも黒点の形状が曖昧となっている。
逆に、$l = 2$の場合は$l = 1,3$の場合と比較して白色領域が広くなっている。
特に、$l = 1$の場合では\figref{FLimitCompare3}\figref{FLimitCompare4}黄部付近のsecond side pupilがやや大きいのに対して、それ以降の場合では縮小していることが顕著に観測される。
以上のことから、偽瞳孔のside pupilおよびsecond side pupilには隣接球を通過する光が影響していることがわかり、\secref{SSSidePupil}の理論と一致する。

続いて、実行速度と$l$の関係を示す\figref{FExetimeAndL}。
\begin{figure}[htbp]
  \centering
\subfigure[平均値]{
\includegraphics*[width=.75\columnwidth]{./img/graph/exetime_average.png}
\label{FExetimeAverage}}\\
\subfigure[実測値]{
\includegraphics*[width=.75\columnwidth]{./img/graph/exetime_samp.png}
\label{FExetimeSamp}}
  \caption{実行速度と$l$の関係}
  \label{FExetimeAndL}
\end{figure}
平均値\figref{FExetimeAverage}と実測値\figref{FExetimeSamp}のいずれのグラフからも、実行速度と通過隣接球上限値$l$は線形の関係であることがわかる。
さらに、リアルタイムの基準が60 fpsであるとすると、今回の球体オブジェクトの場合では$l=900$付近がリアルタイムの限界値であると考えられる。
また、先述のように$l=3$以上では結果画像に有意な差が見られないことから、$l$の設定値は$10^1$オーダーで十分であると言える。

%% \textcolor{red}{実行速度と$l = 10$程度で十分とかそういう話}


\newpage
\begin{figure}[htbp]
  \centering
\subfigure[$l = 0$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/000/marker4.png}
\label{FMarker0}}
\subfigure[$l = 1$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/001/marker4.png}
\label{FMarker1}}\\
\subfigure[$l = 2$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/002/marker4.png}
\label{FMarker2}}
\subfigure[$l = 3$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/003/marker4.png}
\label{FMarker3}}\\
  \caption{上限値による画像の変化比較3}
  \label{FLimitCompare3}
\end{figure}

\begin{figure}[htbp]
  \centering
\subfigure[$l = 0$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/000/marker.png}
\label{FMarker0}}
\subfigure[$l = 1$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/001/marker.png}
\label{FMarker1}}\\
\subfigure[$l = 2$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/002/marker.png}
\label{FMarker2}}
\subfigure[$l = 3$]{
\includegraphics*[width=.45\columnwidth]{./img/screenshot/sphere/RefracLimit/003/marker.png}
\label{FMarker3}}\\
  \caption{上限値による画像の変化比較4}
  \label{FLimitCompare4}
\end{figure}


\newpage
\subsection{カメラとの距離}
\label{SSCameraDist}

\subsection{テクスチャ解像度}
\label{SSTexReso}


%------------------------------------------------------------------------------------------

\section{その他}
\label{S}

\subsection{さまざまなテクスチャ}
\label{SS}

\section{さまざまなオブジェクト}
\label{S}

\section{応用事例}
\label{S}





%--前書いてたやつ----------------------------------------------------------------------------------------
%% \newpage
%% \section{平面オブジェクトに適用した結果}
%% \label{SPlaneObject}

%% 本研究で提案した屈折を表現する手法の有用性を評価するため、平面オブジェクトに対して球体レンズを適用する実験を行った。


%% \begin{figure}[htbp]
%%   \centering
%% \subfigure[CAPTIONa]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot001.bmp}
%% \label{F}}
%% \subfigure[CAPTIONb]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot002.bmp}
%% \label{F}}\\
%% \subfigure[CAPTIONc]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot003.bmp}
%% \label{F}}
%% \subfigure[CAPTIONd]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot004.bmp}
%% \label{F}}\\
%% \subfigure[CAPTIONa]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot005.bmp}
%% \label{F}}
%% \subfigure[CAPTIONb]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot006.bmp}
%% \label{F}}\\
%%   \caption{CAPTION}
%%   \label{F}
%% \end{figure}

%% \begin{figure}[htbp]
%%   \centering
%% \subfigure[CAPTIONa]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot007.bmp}
%% \label{F}}
%% \subfigure[CAPTIONb]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot008.bmp}
%% \label{F}}\\
%% \subfigure[CAPTIONc]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot009.bmp}
%% \label{F}}
%% \subfigure[CAPTIONd]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot010.bmp}
%% \label{F}}\\
%% \subfigure[CAPTIONa]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot011.bmp}
%% \label{F}}
%% \subfigure[CAPTIONb]{
%% \includegraphics*[width=.45\columnwidth]{./img/single/screenshot012.bmp}
%% \label{F}}\\
%%   \caption{CAPTION}
%%   \label{F}
%% \end{figure}
